<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Super Admin | UNI-PASS</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script type="module" src="../assets/js/route-guard.js"></script>
    <link rel="stylesheet" href="../../assets/css/style.css">
    <script src="../../assets/js/ui.js" defer></script>
</head>
<body class="bg-slate-100 font-sans h-screen flex overflow-hidden">

    <aside class="w-64 bg-slate-900 text-white flex flex-col flex-shrink-0 transition-all duration-300 shadow-xl z-20">
        <div class="h-16 flex items-center px-6 border-b border-slate-800 bg-slate-950">
            <div class="w-8 h-8 bg-blue-600 rounded flex items-center justify-center mr-3 font-bold text-lg">A</div>
            <span class="font-bold text-lg tracking-wider text-slate-100">ADMIN</span>
        </div>

        <nav class="flex-1 p-4 space-y-2 overflow-y-auto">
            <p class="px-4 text-xs font-bold text-slate-500 uppercase mb-2 mt-2">Overview</p>
            
            <button onclick="switchTab('dashboard')" id="nav-dashboard" class="nav-item w-full flex items-center px-4 py-3 bg-blue-600 text-white rounded-xl transition shadow-lg shadow-blue-900/20">
                <i class="fas fa-th-large w-5 mr-3"></i> Dashboard
            </button>

            <p class="px-4 text-xs font-bold text-slate-500 uppercase mb-2 mt-6">Management</p>

            <button onclick="switchTab('approvals')" id="nav-approvals" class="nav-item w-full flex items-center px-4 py-3 text-slate-400 hover:bg-slate-800 hover:text-white rounded-xl transition group">
                <div class="relative mr-3">
                    <i class="fas fa-user-shield w-5 group-hover:text-blue-400"></i>
                    <span id="badge-pending" class="absolute -top-2 -right-2 bg-red-500 text-white text-[10px] font-bold px-1.5 py-0.5 rounded-full hidden border border-slate-900">0</span>
                </div>
                Staff Approvals
            </button>

            <button onclick="switchTab('users')" id="nav-users" class="nav-item w-full flex items-center px-4 py-3 text-slate-400 hover:bg-slate-800 hover:text-white rounded-xl transition group">
                <i class="fas fa-users w-5 mr-3 group-hover:text-blue-400"></i> Directory
            </button>
            
            </nav>

        <div class="p-4 border-t border-slate-800">
            <button id="logout-btn" class="w-full py-2.5 border border-slate-700 text-slate-400 rounded-lg hover:bg-red-600 hover:text-white hover:border-red-600 transition flex items-center justify-center gap-2 text-sm font-medium">
                <i class="fas fa-sign-out-alt"></i> Sign Out
            </button>
        </div>
    </aside>

    <main class="flex-1 flex flex-col h-screen overflow-hidden relative">
        <header class="h-16 bg-white shadow-sm flex items-center justify-between px-8 z-10 border-b border-slate-200">
            <h2 class="text-xl font-bold text-slate-800 flex items-center gap-2">
                <i class="fas fa-columns text-slate-400 text-lg"></i>
                <span id="page-title">System Overview</span>
            </h2>
            <div class="flex items-center gap-4">
                <div class="text-right hidden md:block">
                    <p class="text-sm font-bold text-slate-900">System Admin</p>
                    <p class="text-xs text-slate-500">IT Department</p>
                </div>
                <div class="w-10 h-10 rounded-full bg-slate-100 border border-slate-200 flex items-center justify-center text-slate-500">
                    <i class="fas fa-user-cog"></i>
                </div>
            </div>
        </header>

        <div class="flex-1 overflow-y-auto p-8 bg-slate-100">
            
            <div id="view-dashboard" class="space-y-6 animate-fade-in">
                <div class="grid grid-cols-1 md:grid-cols-3 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden group hover:shadow-md transition">
                        <div class="absolute right-0 top-0 h-full w-1 bg-blue-500"></div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Total Students</p>
                        <h3 class="text-4xl font-black text-slate-800 mt-2 group-hover:text-blue-600 transition" id="stat-students">--</h3>
                        <div class="absolute right-6 top-6 text-slate-100 text-5xl group-hover:text-slate-50 transition -z-0">
                            <i class="fas fa-user-graduate"></i>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden group hover:shadow-md transition">
                        <div class="absolute right-0 top-0 h-full w-1 bg-purple-500"></div>
                        <p class="text-xs font-bold text-slate-400 uppercase tracking-wider">Active Faculty</p>
                        <h3 class="text-4xl font-black text-slate-800 mt-2 group-hover:text-purple-600 transition" id="stat-faculty">--</h3>
                        <div class="absolute right-6 top-6 text-slate-100 text-5xl group-hover:text-slate-50 transition -z-0">
                            <i class="fas fa-chalkboard-teacher"></i>
                        </div>
                    </div>

                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200 relative overflow-hidden group hover:shadow-md transition cursor-pointer" onclick="switchTab('approvals')">
                        <div class="absolute right-0 top-0 h-full w-1 bg-orange-500"></div>
                        <p class="text-xs font-bold text-orange-600 uppercase tracking-wider flex items-center gap-2">
                            Pending Requests <span class="animate-ping w-2 h-2 bg-orange-500 rounded-full"></span>
                        </p>
                        <h3 class="text-4xl font-black text-slate-800 mt-2 group-hover:text-orange-600 transition" id="stat-pending">--</h3>
                        <div class="absolute right-6 top-6 text-slate-100 text-5xl group-hover:text-slate-50 transition -z-0">
                            <i class="fas fa-user-clock"></i>
                        </div>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-2 gap-6">
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-700 mb-4">Permission Status Overview</h3>
                        <div class="h-64 relative w-full">
                            <canvas id="statusChart"></canvas>
                        </div>
                    </div>
                    <div class="bg-white p-6 rounded-2xl shadow-sm border border-slate-200">
                        <h3 class="font-bold text-slate-700 mb-4">Reason Distribution</h3>
                        <div class="h-64 relative w-full">
                            <canvas id="reasonChart"></canvas>
                        </div>
                    </div>
                </div>
            </div>

            <div id="view-approvals" class="hidden animate-fade-in">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 overflow-hidden">
                    <div class="px-6 py-4 border-b border-slate-100 bg-orange-50/50 flex justify-between items-center">
                        <div>
                            <h3 class="font-bold text-orange-800">Pending Staff Requests</h3>
                            <p class="text-xs text-slate-500">Faculty and Lab Assistants requiring verification.</p>
                        </div>
                        <span class="bg-orange-100 text-orange-700 text-xs font-bold px-3 py-1 rounded-full border border-orange-200">Action Required</span>
                    </div>
                    <div id="approval-list" class="divide-y divide-slate-100">
                        <div class="p-8 text-center text-slate-400">Loading requests...</div>
                    </div>
                </div>
            </div>

            <div id="view-users" class="hidden animate-fade-in">
                <div class="bg-white rounded-2xl shadow-sm border border-slate-200 flex flex-col h-full">
                    <div class="p-6 border-b border-slate-100 flex flex-col md:flex-row justify-between items-center gap-4">
                        <div class="relative w-full md:w-96">
                            <i class="fas fa-search absolute left-3 top-3 text-slate-400"></i>
                            <input type="text" id="user-search" placeholder="Search by name or email..." class="w-full pl-10 pr-4 py-2 border border-slate-200 rounded-lg outline-none focus:ring-2 focus:ring-blue-500 transition" onkeyup="loadUsers()">
                        </div>
                        <button onclick="window.toggleModal(true)" class="bg-slate-900 hover:bg-slate-800 text-white px-5 py-2 rounded-lg text-sm font-bold shadow-lg shadow-slate-200 transition transform active:scale-95 flex items-center gap-2">
                            <i class="fas fa-plus"></i> Add User
                        </button>
                    </div>
                    
                    <div class="overflow-x-auto">
                        <table class="w-full text-left border-collapse">
                            <thead class="bg-slate-50 text-xs uppercase text-slate-500 font-bold">
                                <tr>
                                    <th class="px-6 py-4">User Identity</th>
                                    <th class="px-6 py-4">Role & ID</th>
                                    <th class="px-6 py-4">Status</th>
                                    <th class="px-6 py-4 text-right">Actions</th>
                                </tr>
                            </thead>
                            <tbody id="user-list" class="text-sm divide-y divide-slate-100 bg-white">
                                </tbody>
                        </table>
                    </div>
                </div>
            </div>

        </div>
    </main>

    <div id="user-modal" class="fixed inset-0 z-50 hidden">
        <div class="absolute inset-0 bg-slate-900/60 backdrop-blur-sm transition-opacity" onclick="window.toggleModal(false)"></div>
        <div class="absolute top-1/2 left-1/2 transform -translate-x-1/2 -translate-y-1/2 bg-white rounded-2xl shadow-2xl p-8 w-full max-w-md scale-100 transition-transform">
            
            <div class="flex justify-between items-start mb-6">
                <h3 class="text-xl font-bold text-slate-800">Add New User</h3>
                <button onclick="window.toggleModal(false)" class="text-slate-400 hover:text-slate-600"><i class="fas fa-times text-xl"></i></button>
            </div>
            
            <form id="add-user-form" onsubmit="window.saveUser(event)">
                <div class="space-y-4">
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Full Name</label>
                        <input type="text" id="new-name" required class="w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Email Address</label>
                        <input type="email" id="new-email" required class="w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none">
                    </div>
                    
                    <div class="grid grid-cols-2 gap-4">
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Role</label>
                            <select id="new-role" class="w-full border border-slate-300 rounded-lg p-2.5 bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="student">Student</option>
                                <option value="teacher">Teacher</option>
                                <option value="hod">HOD</option>
                                <option value="lab_assistant">Lab Assistant</option> </select>
                        </div>
                        <div>
                            <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Department</label>
                            <select id="new-dept" class="w-full border border-slate-300 rounded-lg p-2.5 bg-white focus:ring-2 focus:ring-blue-500 outline-none">
                                <option value="CSE">CSE</option>
                                <option value="ECE">ECE</option>
                                <option value="MECH">Mechanical</option>
                                <option value="CIVIL">Civil</option>
                                <option value="EEE">EEE</option>
                            </select>
                        </div>
                    </div>

                    <div>
                        <label class="block text-xs font-bold text-slate-500 uppercase mb-1">Roll Number / ID</label>
                        <input type="text" id="new-roll" class="w-full border border-slate-300 rounded-lg p-2.5 focus:ring-2 focus:ring-blue-500 outline-none transition-colors" placeholder="e.g. 24331A4201">
                        <p id="roll-hint" class="text-[10px] text-slate-400 mt-1">Required for students only.</p>
                    </div>
                </div>

                <div class="mt-8 flex justify-end gap-3">
                    <button type="button" onclick="window.toggleModal(false)" class="px-5 py-2.5 text-slate-600 hover:bg-slate-100 rounded-lg font-medium transition">Cancel</button>
                    <button type="submit" class="px-6 py-2.5 bg-blue-600 text-white font-bold rounded-lg hover:bg-blue-700 shadow-lg shadow-blue-200 transition transform active:scale-95">Create User</button>
                </div>
                
                <div class="mt-4 p-3 bg-blue-50 text-blue-700 text-xs rounded border border-blue-100 flex items-start gap-2">
                    <i class="fas fa-info-circle mt-0.5"></i> 
                    <span>This creates a database profile. The user must still <b>Sign Up</b> with this email to set their password.</span>
                </div>
            </form>
        </div>
    </div>

    <script type="module">
        import { db, auth } from '../assets/js/firebase-init.js';

        let statusChartInst = null;
        let reasonChartInst = null;

        auth.onAuthStateChanged(async user => {
            if (!user) location.href = '../public/login.html';
            
            const doc = await db.collection('users').doc(user.uid).get();
            if(!doc.exists || doc.data().role !== 'admin') {
                alert("Unauthorized Access");
                await auth.signOut();
                location.href = '../public/login.html';
            }

            loadStats();
            initCharts();
            listenForApprovals();
        });

        window.switchTab = (tab) => {
            ['dashboard', 'approvals', 'users'].forEach(t => {
                document.getElementById(`view-${t}`).classList.add('hidden');
                document.getElementById(`nav-${t}`).classList.remove('bg-blue-600', 'text-white', 'shadow-lg');
                document.getElementById(`nav-${t}`).classList.add('text-slate-400', 'hover:bg-slate-800');
            });
            
            document.getElementById(`view-${tab}`).classList.remove('hidden');
            const activeNav = document.getElementById(`nav-${tab}`);
            activeNav.classList.remove('text-slate-400', 'hover:bg-slate-800');
            activeNav.classList.add('bg-blue-600', 'text-white', 'shadow-lg');

            if(tab === 'users') loadUsers();
        };

        window.toggleModal = (show) => {
            document.getElementById('user-modal').classList.toggle('hidden', !show);
        };

        document.getElementById('new-role').addEventListener('change', (e) => {
            const rollInput = document.getElementById('new-roll');
            const hint = document.getElementById('roll-hint');
            
            if (e.target.value === 'student') {
                rollInput.disabled = false;
                rollInput.classList.remove('bg-slate-100', 'text-slate-400', 'cursor-not-allowed');
                rollInput.classList.add('bg-white');
                rollInput.placeholder = "e.g. 24331A4201";
                hint.innerText = "Required for students.";
            } else {
                rollInput.value = '';
                rollInput.disabled = true;
                rollInput.classList.add('bg-slate-100', 'text-slate-400', 'cursor-not-allowed');
                rollInput.classList.remove('bg-white');
                rollInput.placeholder = "Auto-assigned by System";
                hint.innerText = "ID will be set to 'Staff' automatically.";
            }
        });

        // --- 1. STATISTICS & CHARTS ---
        async function loadStats() {
            const snapS = await db.collection('users').where('role', '==', 'student').get();
            const snapF = await db.collection('users').where('role', 'in', ['teacher', 'hod', 'lab_assistant']).get();
            
            document.getElementById('stat-students').innerText = snapS.size;
            document.getElementById('stat-faculty').innerText = snapF.size;
        }

        async function initCharts() {
            const snap = await db.collection('permissions').limit(100).get();
            let statusCounts = { APPROVED: 0, REJECTED: 0, PENDING: 0 };
            let reasonCounts = {};

            snap.forEach(doc => {
                const d = doc.data();
                if (d.status === 'APPROVED') statusCounts.APPROVED++;
                else if (d.status === 'REJECTED') statusCounts.REJECTED++;
                else statusCounts.PENDING++;

                const r = d.reasonType || 'Other';
                reasonCounts[r] = (reasonCounts[r] || 0) + 1;
            });

            const ctx1 = document.getElementById('statusChart').getContext('2d');
            if(statusChartInst) statusChartInst.destroy();
            statusChartInst = new Chart(ctx1, {
                type: 'doughnut',
                data: {
                    labels: ['Approved', 'Rejected', 'Pending'],
                    datasets: [{
                        data: [statusCounts.APPROVED, statusCounts.REJECTED, statusCounts.PENDING],
                        backgroundColor: ['#22c55e', '#ef4444', '#f59e0b'],
                        borderWidth: 0
                    }]
                },
                options: { cutout: '70%', responsive: true, maintainAspectRatio: false, plugins: { legend: { position: 'right' } } }
            });

            const ctx2 = document.getElementById('reasonChart').getContext('2d');
            if(reasonChartInst) reasonChartInst.destroy();
            reasonChartInst = new Chart(ctx2, {
                type: 'bar',
                data: {
                    labels: Object.keys(reasonCounts),
                    datasets: [{
                        label: 'Requests',
                        data: Object.values(reasonCounts),
                        backgroundColor: '#3b82f6',
                        borderRadius: 6
                    }]
                },
                options: { 
                    responsive: true, maintainAspectRatio: false, plugins: { legend: { display: false } },
                    scales: { y: { beginAtZero: true, grid: { display: false } }, x: { grid: { display: false } } } 
                }
            });
        }

        // --- 2. PENDING APPROVALS LISTENER ---
        function listenForApprovals() {
            db.collection('users')
                .where('role', '==', 'pending')
                .onSnapshot(snap => {
                    const list = document.getElementById('approval-list');
                    const count = document.getElementById('stat-pending');
                    const badge = document.getElementById('badge-pending');
                    
                    count.innerText = snap.size;
                    badge.innerText = snap.size;
                    badge.classList.toggle('hidden', snap.size === 0);
                    
                    list.innerHTML = '';
                    if (snap.empty) {
                        list.innerHTML = '<div class="p-12 text-center text-slate-400">All clear! No pending requests.</div>';
                        return;
                    }

                    snap.forEach(doc => {
                        const u = doc.data();
                        let reqRole = u.requestedRole ? u.requestedRole.toUpperCase() : 'FACULTY';
                        if(reqRole === 'LAB_ASSISTANT') reqRole = 'LAB ASSIST'; 
                        
                        const item = document.createElement('div');
                        item.className = "p-6 flex items-center justify-between hover:bg-slate-50 transition";
                        item.innerHTML = `
                            <div class="flex items-center gap-4">
                                <div class="w-12 h-12 rounded-full bg-purple-100 text-purple-600 flex items-center justify-center font-bold text-xl border border-purple-200">
                                    ${u.displayName.charAt(0).toUpperCase()}
                                </div>
                                <div>
                                    <h4 class="font-bold text-slate-800 text-lg">${u.displayName}</h4>
                                    <div class="flex items-center gap-2 text-sm text-slate-500">
                                        <i class="fas fa-envelope text-slate-400"></i> ${u.email}
                                    </div>
                                    <span class="inline-block mt-1 px-2 py-0.5 bg-purple-50 text-purple-700 text-[10px] font-bold uppercase rounded border border-purple-100">
                                        Requesting: ${reqRole}
                                    </span>
                                </div>
                            </div>
                            <div class="flex gap-3">
                                <button onclick="decide('${doc.id}', 'reject')" class="px-4 py-2 border border-red-200 text-red-600 rounded-lg hover:bg-red-50 text-sm font-bold transition">Block</button>
                                <button onclick="decide('${doc.id}', 'approve', '${u.requestedRole}')" class="px-5 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700 text-sm font-bold shadow-md shadow-blue-200 transition transform active:scale-95">Approve Access</button>
                            </div>
                        `;
                        list.appendChild(item);
                    });
                });
        }

        window.decide = async (uid, action, reqRole) => {
            if (!confirm(`Are you sure you want to ${action.toUpperCase()} this user?`)) return;

            if (action === 'approve') {
                await db.collection('users').doc(uid).update({
                    role: reqRole || 'teacher', 
                    isBlocked: false,
                    approvedAt: new Date().toISOString()
                });
            } else {
                await db.collection('users').doc(uid).update({ role: 'blocked', isBlocked: true });
            }
        };

        // --- 3. USER MANAGEMENT ---
        window.loadUsers = async () => {
            const list = document.getElementById('user-list');
            const search = document.getElementById('user-search').value.toLowerCase();
            
            list.innerHTML = '<tr><td colspan="4" class="p-8 text-center text-slate-400"><i class="fas fa-circle-notch fa-spin"></i> Loading directory...</td></tr>';
            
            const snap = await db.collection('users').orderBy('createdAt', 'desc').limit(50).get();
            list.innerHTML = '';

            snap.forEach(doc => {
                const u = doc.data();
                if (search && !u.email.toLowerCase().includes(search) && !u.displayName.toLowerCase().includes(search)) return;

                const isBlocked = u.isBlocked === true;
                const statusBadge = isBlocked 
                    ? `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-red-100 text-red-700 border border-red-200"><i class="fas fa-ban"></i> BLOCKED</span>`
                    : `<span class="inline-flex items-center gap-1.5 px-2.5 py-1 rounded-full text-xs font-bold bg-green-100 text-green-700 border border-green-200"><i class="fas fa-check-circle"></i> ACTIVE</span>`;

                const actionBtn = isBlocked
                    ? `<button onclick="toggleBlock('${doc.id}', false)" class="text-green-600 hover:text-green-800 bg-green-50 hover:bg-green-100 px-3 py-1.5 rounded-lg text-xs font-bold transition border border-green-200">Unblock User</button>`
                    : `<button onclick="toggleBlock('${doc.id}', true)" class="text-red-600 hover:text-red-800 bg-red-50 hover:bg-red-100 px-3 py-1.5 rounded-lg text-xs font-bold transition border border-red-200">Block Access</button>`;

                list.innerHTML += `
                    <tr class="hover:bg-slate-50 transition border-b border-slate-100 last:border-0">
                        <td class="px-6 py-4">
                            <div class="font-bold text-slate-800">${u.displayName}</div>
                            <div class="text-xs text-slate-500 font-mono">${u.email}</div>
                        </td>
                        <td class="px-6 py-4">
                            <span class="uppercase text-xs font-bold text-slate-500 bg-slate-100 px-2 py-1 rounded">${u.role}</span>
                            ${u.rollNumber ? `<div class="text-[10px] text-slate-400 mt-1 font-mono">ID: ${u.rollNumber}</div>` : ''}
                        </td>
                        <td class="px-6 py-4">${statusBadge}</td>
                        <td class="px-6 py-4 text-right">${actionBtn}</td>
                    </tr>
                `;
            });
        };

        window.toggleBlock = async (uid, shouldBlock) => {
            const msg = shouldBlock ? "BLOCK this user?" : "UNBLOCK this user?";
            if(confirm(msg)) {
                await db.collection('users').doc(uid).update({ isBlocked: shouldBlock });
                loadUsers();
            }
        };

        // --- 4. MANUAL USER ADD (FIXED SCHEMA) ---
        window.saveUser = async (e) => {
            e.preventDefault();
            const btn = e.target.querySelector('button[type="submit"]');
            btn.innerHTML = '<i class="fas fa-circle-notch fa-spin"></i> Saving...';
            btn.disabled = true;

            try {
                const name = document.getElementById('new-name').value;
                const email = document.getElementById('new-email').value;
                const role = document.getElementById('new-role').value;
                const dept = document.getElementById('new-dept').value;
                const roll = document.getElementById('new-roll').value;

                // --- GOLDEN SCHEMA LOGIC ---
                let finalRoll = null;
                let section = "N/A";
                let year = "4"; 

                if (role === 'student') {
                    finalRoll = roll.toUpperCase();
                    year = "2"; 
                    section = "A"; // Default for manual entry
                } else {
                    // Force Staff ID logic
                    if (role === 'teacher') {
                        finalRoll = "Staff";
                        section = "Faculty";
                    } else if (role === 'hod') {
                        finalRoll = "HOD";
                        section = "Head";
                    } else if (role === 'lab_assistant') {
                        finalRoll = "LAB";
                        section = "Labs";
                    } else {
                        finalRoll = "Admin";
                        section = "IT";
                    }
                }

                await db.collection('users').add({
                    displayName: name,
                    email: email,
                    role: role,
                    department: dept,
                    
                    // Critical Fields for Permissions
                    rollNumber: finalRoll,
                    section: section,
                    year: year,
                    
                    attendance: 75,
                    isBlocked: false,
                    createdAt: new Date().toISOString()
                });

                alert("User profile created successfully!");
                window.toggleModal(false);
                loadUsers();
                e.target.reset(); 
            } catch (err) {
                alert("Error: " + err.message);
            } finally {
                btn.innerText = "Create User";
                btn.disabled = false;
            }
        };

        document.getElementById('logout-btn').onclick = () => {
            sessionStorage.clear();
            auth.signOut().then(() => location.href = '../public/login.html');
        };
    </script>
</body>
</html>